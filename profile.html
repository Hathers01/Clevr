<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- Judul diubah khusus untuk halaman ini -->
    <title>Akun Saya - CLEVR</title>

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Google Fonts: Inter & Poppins -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">

    <style>
        /* CSS Kustom (Hanya yang relevan) */
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f7fafc; /* bg-gray-100 */
        }
        
        .d-none {
            display: none !important;
        }

        /* Animasi untuk Notifikasi Modal */
        .notification-modal-content {
            transition: all 0.3s ease-in-out;
        }
        .notification-modal-content.show {
            transform: translateY(0);
            opacity: 1;
        }
        .notification-modal-content.hide {
            transform: translateY(-50px);
            opacity: 0;
        }
    </style>
</head>
<body class="text-gray-800">

    <!-- ============================================== -->
    <!-- ================ PROFILE PAGE ================== -->
    <!-- ============================================== -->
    <!-- Halaman ini tidak lagi disembunyikan -->
    <div id="profilePage">
        <header class="bg-white shadow-sm sticky top-0 z-50">
            <div class="container mx-auto px-4 py-4 flex items-center justify-between">
                <!-- Tautan diubah untuk menunjuk ke file lain -->
                <a href="#" class="nav-logo">
                    <img src="foto/logo.jpeg" alt="CLEVR Logo" class="h-16 md:h-18" id="nav-logo-profile"> 
                  </a>
                 <div class="relative flex-grow mx-8 hidden md:block">
                     <input type="text" placeholder="Search is disabled on this page" class="w-full pl-10 pr-4 py-2 rounded-full border border-gray-300 bg-gray-100 cursor-not-allowed" autocomplete="off" disabled>
                </div>
                <nav id="profile-nav" class="flex items-center space-x-4">
                     <div class="clover-wallet flex items-center space-x-2 bg-green-100 text-green-800 font-semibold px-4 py-2 rounded-full transition">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-green-600" fill="currentColor" viewBox="0 0 20 20"><path d="M15.42 4.58a7.5 7.5 0 1 0 0 10.84 7.5 7.5 0 0 0 0-10.84zM10 18a8 8 0 1 0 0-16 8 8 0 0 0 0 16z"/><path d="M10 2a1 1 0 0 1 1 1v2a1 1 0 1 1-2 0V3a1 1 0 0 1 1-1zm0 14a1 1 0 0 1 1 1v2a1 1 0 1 1-2 0v-2a1 1 0 0 1 1-1zM4.93 4.93a1 1 0 0 1 1.41 0l1.42 1.42a1 1 0 0 1-1.42 1.41L4.93 6.34a1 1 0 0 1 0-1.41zm10.6 10.6a1 1 0 0 1 1.41 0l1.42 1.42a1 1 0 0 1-1.42 1.41l-1.41-1.42a1 1 0 0 1 0-1.41zM2 10a1 1 0 0 1 1-1h2a1 1 0 1 1 0 2H3a1 1 0 0 1-1-1zm14 0a1 1 0 0 1 1-1h2a1 1 0 1 1 0 2h-2a1 1 0 0 1-1-1zm-2.12-5.07a1 1 0 0 1 1.41 0l1.42-1.42a1 1 0 1 1 1.41 1.42l-1.41 1.41a1 1 0 0 1-1.41-1.41zM4.93 15.07a1 1 0 0 1 1.41 0l-1.42 1.42a1 1 0 0 1-1.41-1.42l1.41-1.41z"/></svg>
                        <span class="clover-balance">150</span>
                        <svg class="openCloverModalBtn h-5 w-5 text-green-700 cursor-pointer transition-transform duration-300 ease-in-out transform hover:scale-125 hover:drop-shadow-lg" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M10 3a1 1 0 011 1v5h5a1 1 0 110 2h-5v5a1 1 0 11-2 0v-5H4a1 1 0 110-2h5V4a1 1 0 011-1z" clip-rule="evenodd" /></svg>
                    </div>
                    <!-- Tautan diubah untuk menunjuk ke file lain -->
                    <a href="my_classes.html" class="relative p-2 rounded-full hover:bg-gray-200 transition-colors group nav-my-classes">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-purple-600 group-hover:text-purple-800" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path d="M12 14l9-5-9-5-9 5 9 5z" /><path d="M12 14l6.16-3.422a12.083 12.083 0 01.665 6.479A11.952 11.952 0 0012 20.055a11.952 11.952 0 00-6.824-2.998 12.078 12.078 0 01.665-6.479L12 14z" /><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 14l9-5-9-5-9 5 9 5zm0 0l6.16-3.422a12.083 12.083 0 01.665 6.479A11.952 11.952 0 0012 20.055a11.952 11.952 0 00-6.824-2.998 12.078 12.078 0 01.665-6.479L12 14zm-4 6v-7.5l4-2.222" /></svg>
                         <span class="new-class-indicator absolute top-1 right-1 h-2 w-2 rounded-full bg-red-500 d-none"></span>
                    </a>
                    <!-- Tautan ini sekarang aktif -->
                    <a href="#" class="p-2 rounded-full bg-gray-200 transition-colors group nav-profile">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-purple-600 group-hover:text-purple-800" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" /></svg>
                    </a>
                </nav>
            </div>
        </header>
        <main class="container mx-auto px-4 py-8">
            <div class="bg-white rounded-lg shadow-lg p-8 max-w-2xl mx-auto">
                <div class="flex flex-col sm:flex-row items-center sm:items-start text-center sm:text-left space-y-4 sm:space-y-0 sm:space-x-8">
                    <img id="profile-page-image" src="https://placehold.co/128x128" alt="Profile Picture" class="w-32 h-32 rounded-full border-4 border-purple-200">
                    <div id="profile-header-content" class="flex-grow">
                          <!-- Content changes based on view/edit mode -->
                    </div>
                </div>
                <div id="profile-details-content" class="mt-8 border-t pt-6 space-y-4">
                      <!-- Content changes based on view/edit mode -->
                </div>
            </div>
        </main>
    </div>

    <!-- ============================================== -->
    <!-- ========= MODAL YANG DIPERLUKAN SAJA ========= -->
    <!-- ============================================== -->

    <!-- Buy Clover Modal & Payment Flow -->
    <div id="buyCloverModal" class="fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center p-4 z-[100] d-none">
        <div class="bg-white rounded-2xl shadow-xl w-full max-w-md">
            <!-- Header -->
            <div class="p-6 border-b flex justify-between items-center">
                <h3 id="payment-modal-title" class="text-2xl font-bold text-gray-800">Buy Clovers</h3>
                <button id="closeCloverModalBtn" class="text-gray-500 hover:text-gray-800 transition-colors">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" /></svg>
                </button>
            </div>
            <!-- Body -->
            <div class="p-6 max-h-[60vh] overflow-y-auto">
                <!-- Step 1: Packages -->
                <div id="clover-packages-container" class="space-y-4">
                    <!-- Clover packages will be injected here by JavaScript -->
                </div>
                <!-- Step 2: Payment Methods -->
                <div id="payment-methods-container" class="d-none">
                    <button class="w-full text-left p-2 hover:bg-gray-100 mb-2 payment-back-btn">&larr; Back to packages</button>
                    <h4 class="font-bold text-lg mb-4">Choose a Payment Method</h4>
                    <div class="space-y-3">
                        <button data-method="GoPay" class="payment-method-btn w-full text-left p-4 border rounded-lg flex justify-between items-center hover:bg-gray-50">GoPay <span>&rarr;</span></button>
                        <button data-method="QRIS" class="payment-method-btn w-full text-left p-4 border rounded-lg flex justify-between items-center hover:bg-gray-50">QRIS <span>&rarr;</span></button>
                        <button data-method="Dana" class="payment-method-btn w-full text-left p-4 border rounded-lg flex justify-between items-center hover:bg-gray-50">Dana <span>&rarr;</span></button>
                        <button data-method="MyBCA" class="payment-method-btn w-full text-left p-4 border rounded-lg flex justify-between items-center hover:bg-gray-50">MyBCA <span>&rarr;</span></button>
                        <button data-method="Livin' Mandiri" class="payment-method-btn w-full text-left p-4 border rounded-lg flex justify-between items-center hover:bg-gray-50">Livin' Mandiri <span>&rarr;</span></button>
                    </div>
                </div>
                <!-- Step 3: Instructions -->
                <div id="payment-instructions-container" class="d-none">
                    <button class="w-full text-left p-2 hover:bg-gray-100 mb-2 payment-back-btn">&larr; Back to methods</button>
                    <h4 id="payment-instruction-title" class="font-bold text-lg mb-4">Payment Instructions</h4>
                    <div id="payment-instruction-steps" class="text-gray-700 space-y-2">
                        <!-- Instructions will be injected here -->
                    </div>
                    <button id="confirm-transfer-btn" class="mt-6 w-full bg-green-500 text-white font-bold py-3 rounded-lg hover:bg-green-600 transition-colors">I Have Transferred</button>
                </div>
            </div>
        </div>
    </div>


    <!-- Notification Modal -->
    <div id="notificationModal" class="fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center p-4 z-[150] d-none">
        <div id="notification-content" class="notification-modal-content transform -translate-y-10 opacity-0 bg-white p-8 rounded-2xl shadow-xl text-center w-full max-w-sm">
            <div id="notification-icon" class="mx-auto mb-4">
                <!-- SVG Icon will be injected here -->
            </div>
            <p id="notification-message" class="text-lg font-medium text-gray-700">Notification message goes here.</p>
            <button id="notification-close-btn" class="mt-6 bg-purple-600 text-white font-bold py-2 px-8 rounded-full hover:bg-purple-700 transition-colors">OK</button>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            
            // === PERBAIKAN 1: OTENTIKASI & REDIRECT ===
            // Ambil ID user dari localStorage
            let currentLoggedInUser = localStorage.getItem('clevrLoggedInUserId');

            // Jika tidak ada yang login (belum login),
            // paksa kembali ke halaman login.
            if (!currentLoggedInUser) {
                window.location.href = 'index.html'; // Asumsi login page adalah index.html
                return; // Hentikan eksekusi script ini
            }
            // === SELESAI PERBAIKAN 1 ===
            // Membuat logo CLEVR "pintar"
            const logoLink = document.getElementById('nav-logo-profile');
            if (logoLink) {
                logoLink.addEventListener('click', function(e) {
                    e.preventDefault(); // Mencegah link '#'
                    
                    if (currentLoggedInUser === 'student') {
                        window.location.href = 'home_user.html';
                    } else if (tutors[currentLoggedInUser]) {
                        // Asumsi jika bukan student, dia tutor
                        window.location.href = 'home_tutor.html'; // Arahkan ke home tutor
                    } else {
                        // Fallback jika terjadi error
                        window.location.href = 'index.html';
                    }
                });
            }
            // === SELESAI ===
            
            // --- DUMMY DATA (Hanya yang relevan) ---
            
            // === PERBAIKAN 2: AMBIL DATA DARI LOCALSTORAGE ===
            // Pastikan kita memuat data yang KONSISTEN dari localStorage
            // Ini adalah data yang sama dengan yang dimuat di home.js
            
            let user = JSON.parse(localStorage.getItem('clevrUser')) || {
                clovers: 150
            };
            
            // Data Tutors dan Student DIPERLUKAN oleh renderProfilePage
            let tutors = JSON.parse(localStorage.getItem('clevrTutors')) || {
                'Dara': { id: 'Dara', name: 'Dara Alifa Maulani', subject: 'Mathematics', education: 'Mathematics, Univ. of Indonesia', img: 'https://placehold.co/80x80/fde047/000000?text=DA', detailImg: 'https://placehold.co/128x128/fde047/000000?text=DA', bio: 'Dara is a passionate mathematician with 5 years of tutoring experience...', dob: 'June 10, 1992', address: '123 Math Lane, Jakarta' },
                'Harven': { id: 'Harven', name: 'Marvelius Harven Adrian Lim ', subject: 'Science', education: 'Sociology, Gadjah Mada Univ.', img: 'https://placehold.co/80x80/4ade80/FFFFFF?text=BS', detailImg: 'https://placehold.co/128x128/4ade80/FFFFFF?text=BS', bio: 'Harven brings social studies to life...', dob: 'July 22, 1991', address: '456 Science Rd, Bandung' },
                'Gita': { id: 'Gita', name: 'Gita Aulia Nugrogo', subject: 'Art & Design', education: 'Mathematics, Univ. of Indonesia', img: 'https://placehold.co/80x80/fde047/000000?text=DA', detailImg: 'https://placehold.co/128x128/fde047/000000?text=DA', bio: 'Gita is a passionate mathematician with 5 years of tutoring experience...', dob: 'June 10, 1992', address: '789 Art Blvd, Jakarta' },
                'Atha': { id: 'Atha', name: 'Muhammad Athalladithya Rizky', subject: 'Programming', education: 'Sociology, Gadjah Mada Univ.', img: 'https://placehold.co/80x80/4ade80/FFFFFF?text=BS', detailImg: 'https://placehold.co/128x128/4ade80/FFFFFF?text=BS', bio: 'Atha brings social studies to life...', dob: 'July 22, 1991', address: 'Jl. Jeruk II No.23, Depok' },
                // Data tutor lain akan ikut dimuat dari localStorage
            };

            let studentProfile = JSON.parse(localStorage.getItem('clevrStudentProfile')) || {
                 name: 'Bima Satria', role: 'Student', dob: 'August 17, 2005', education: 'Grade 11, SMA Cendekia', address: '123 Learning St, Knowledge City', img: 'https://placehold.co/128x128/f87171/FFFFFF?text=BS', detailImg: 'https://placehold.co/128x128/f87171/FFFFFF?text=BS'
            };
            // === SELESAI PERBAIKAN 2 ===

            let currentCloverPackage = null;
            
            const cloverPackages = [
                { clovers: 50, price: 'Rp 10.000' },
                { clovers: 100, price: 'Rp 20.000' },
                { clovers: 250, price: 'Rp 50.000' },
                { clovers: 500, price: 'Rp 95.000' }
            ];

            // --- DOM Elements (Hanya yang relevan) ---
            const profilePage = document.getElementById('profilePage');
            const cloverBalanceEls = document.querySelectorAll('.clover-balance');
            
            // Modals
            const notificationModal = document.getElementById('notificationModal');
            const notificationContent = document.getElementById('notification-content');
            const notificationIcon = document.getElementById('notification-icon');
            const notificationMessage = document.getElementById('notification-message');
            const notificationCloseBtn = document.getElementById('notification-close-btn');
            const buyCloverModal = document.getElementById('buyCloverModal');
            const closeCloverModalBtn = document.getElementById('closeCloverModalBtn');
            const cloverPackagesContainer = document.getElementById('clover-packages-container');
            const openCloverModalBtns = document.querySelectorAll('.openCloverModalBtn');
            
            
            // === PERBAIKAN 3: TAMBAHKAN FUNGSI saveData ===
            // Fungsi ini akan menyimpan data kembali ke localStorage
            function saveData() {
                localStorage.setItem('clevrUser', JSON.stringify(user));
                // Jangan simpan 'bookedClasses' di sini karena halaman ini tidak mengelolanya
                localStorage.setItem('clevrStudentProfile', JSON.stringify(studentProfile));
                localStorage.setItem('clevrTutors', JSON.stringify(tutors));
                console.log('Data profile saved to localStorage!');
            }
            // === SELESAI PERBAIKAN 3 ===
            

            // --- FUNCTIONS (Hanya yang relevan) ---

            // Update Clover Display
            const updateCloverDisplay = () => {
                cloverBalanceEls.forEach(el => el.textContent = user.clovers);
            };

            // Show Notification (Sudah benar)
            const showNotification = (message, isSuccess, showButton = true) => {
                const successIcon = `<svg class="w-16 h-16 text-green-500" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>`;
                const failureIcon = `<svg class="w-16 h-16 text-red-500" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2m7-2a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>`;
                const loadingIcon = `<svg class="animate-spin h-16 w-16 text-purple-600" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path></svg>`;
                
                notificationMessage.textContent = message;

                if (isSuccess === null) { // Loading state
                    notificationIcon.innerHTML = loadingIcon;
                } else {
                     notificationIcon.innerHTML = isSuccess ? successIcon : failureIcon;
                }
                
                notificationCloseBtn.style.display = showButton ? 'inline-block' : 'none';
                notificationModal.classList.remove('d-none');
                document.body.classList.add('overflow-hidden');
                setTimeout(() => { notificationContent.classList.add('show'); }, 10);
            };

            const hideNotification = () => {
                notificationContent.classList.remove('show');
                setTimeout(() => {
                    notificationModal.classList.add('d-none');
                    if(buyCloverModal.classList.contains('d-none')) {
                       document.body.classList.remove('overflow-hidden');
                    }
                }, 300);
            };

            // Render Clover Packages (Sudah benar)
            const renderCloverPackages = () => {
                if (!cloverPackagesContainer) return; // Tambah penjaga jika elemen tidak ada
                cloverPackagesContainer.innerHTML = '';
                cloverPackages.forEach(pkg => {
                    const pkgEl = document.createElement('div');
                    pkgEl.className = 'flex justify-between items-center bg-gray-100 p-4 rounded-lg';
                    pkgEl.innerHTML = `
                        <div>
                            <p class="font-bold text-lg text-green-600">${pkg.clovers} Clovers</p>
                            <p class="text-gray-600">${pkg.price}</p>
                        </div>
                        <button data-clovers="${pkg.clovers}" class="buy-clover-btn bg-green-600 text-white font-bold py-2 px-6 rounded-full hover:bg-green-700 transition-colors">Buy</button>
                    `;
                    cloverPackagesContainer.appendChild(pkgEl);
                });
            };
            
            // Render Profile Page (Sudah benar, tinggal tambah tombol logout)
             const renderProfilePage = (editMode = false) => {
                let userProfile;
                if (currentLoggedInUser === 'student') {
                    userProfile = studentProfile;
                } else if (tutors[currentLoggedInUser]) {
                    userProfile = tutors[currentLoggedInUser];
                } else { 
                    // Jika data user tidak ditemukan (error), paksa logout
                    localStorage.removeItem('clevrLoggedInUserId');
                    window.location.href = 'index.html';
                    return; 
                }

                // Adjust header visibility
                const profileNav = document.getElementById('profile-nav');
                const wallet = profileNav.querySelector('.clover-wallet');
                const myClasses = profileNav.querySelector('.nav-my-classes');
                if (currentLoggedInUser === 'student') {
                    wallet.classList.remove('d-none');
                    myClasses.classList.remove('d-none');
                } else {
                    wallet.classList.add('d-none');
                    myClasses.classList.add('d-none');
                }

                const headerContent = document.getElementById('profile-header-content');
                const detailsContent = document.getElementById('profile-details-content');
                const roleText = currentLoggedInUser === 'student' ? 'Student' : 'Clevr Tutor';

                if (editMode) {
                    headerContent.innerHTML = `
                        <div class="flex-grow">
                           <input id="edit-profile-name" class="text-3xl font-bold w-full border-b-2" value="${userProfile.name}">
                           <p class="text-lg text-purple-600 font-semibold">${roleText}</p>
                           <button id="save-profile-btn" class="mt-4 bg-green-500 text-white font-bold py-2 px-6 rounded-full inline-block shadow-md hover:bg-green-600 transition-colors">Save Changes</button>
                        </div>`;
                    detailsContent.innerHTML = `
                         <div class="space-y-4">
                            <div>
                                <h3 class="font-semibold text-gray-500 text-sm">Date of Birth</h3>
                                <input id="edit-profile-dob" class="text-gray-800 w-full border-b" value="${userProfile.dob}">
                            </div>
                            <div>
                                <h3 class="font-semibold text-gray-500 text-sm">Education</h3>
                                <input id="edit-profile-education" class="text-gray-800 w-full border-b" value="${userProfile.education}">
                            </div>
                            <div>
                                <h3 class="font-semibold text-gray-500 text-sm">Address</h3>
                                <input id="edit-profile-address" class="text-gray-800 w-full border-b" value="${userProfile.address}">
                            </div>
                        </div>`;
                } else {
                    // === PERBAIKAN 4: TAMBAHKAN TOMBOL LOGOUT ===
                    headerContent.innerHTML = `
                        <div class="flex-grow">
                            <h1 id="profile-page-name" class="text-3xl font-bold">${userProfile.name}</h1>
                            <p id="profile-page-role" class="text-lg text-purple-600 font-semibold">${roleText}</p>
                            <div class="mt-4 space-x-2">
                                <button id="edit-profile-btn" class="bg-purple-600 text-white font-bold py-2 px-6 rounded-full inline-block shadow-md hover:bg-purple-700 transition-colors">Edit Profile</button>
                                <button id="logout-btn" class="bg-red-500 text-white font-bold py-2 px-6 rounded-full inline-block shadow-md hover:bg-red-600 transition-colors">Log Out</button>
                            </div>
                        </div>`;
                    // === SELESAI PERBAIKAN 4 ===
                    detailsContent.innerHTML = `
                        <div class="space-y-4">
                            <div>
                                <h3 class="font-semibold text-gray-500 text-sm">Date of Birth</h3>
                                <p id="profile-page-dob" class="text-gray-800">${userProfile.dob}</p>
                            </div>
                            <div>
                                <h3 class="font-semibold text-gray-500 text-sm">Education</h3>
                                <p id="profile-page-education" class="text-gray-800">${userProfile.education}</p>
                            </div>
                            <div>
                                <h3 class="font-semibold text-gray-500 text-sm">Address</h3>
                                <p id="profile-page-address" class="text-gray-800">${userProfile.address}</p>
                            </div>
                        </div>`;
                }
                document.getElementById('profile-page-image').src = userProfile.detailImg || userProfile.img || 'https://placehold.co/128x128';
            };


            // Hide Modals
            const hideCloverModal = () => {
                buyCloverModal.classList.add('d-none');
                 if(notificationModal.classList.contains('d-none')) {
                    document.body.classList.remove('overflow-hidden');
                }
            };


            // --- PAGE LOGIC ---
            
            // HAPUS BLOK SIMULASI LOGIN YANG LAMA
            
            // Initial renders on page load
            updateCloverDisplay();
            renderCloverPackages();
            renderProfilePage(false); // Render profil berdasarkan user yang login
            // --- AKHIR SIMULASI ---


            // --- EVENT LISTENERS (Hanya yang relevan) ---
            
            // Open Buy Clover Modal
            openCloverModalBtns.forEach(btn => {
                btn.addEventListener('click', () => {
                    buyCloverModal.classList.remove('d-none');
                    document.body.classList.add('overflow-hidden');
                });
            });


            // Clover Payment Flow (Sudah benar)
            const paymentModalTitle = document.getElementById('payment-modal-title');
            const packagesContainer = document.getElementById('clover-packages-container');
            const methodsContainer = document.getElementById('payment-methods-container');
            const instructionsContainer = document.getElementById('payment-instructions-container');

            if (packagesContainer) {
                packagesContainer.addEventListener('click', (e) => {
                    if(e.target.classList.contains('buy-clover-btn')) {
                        const clovers = e.target.dataset.clovers;
                        const price = cloverPackages.find(p => p.clovers == clovers).price;
                        currentCloverPackage = { clovers: parseInt(clovers), price: price };
                        
                        paymentModalTitle.textContent = `Pay ${price}`;
                        packagesContainer.classList.add('d-none');
                        methodsContainer.classList.remove('d-none');
                    }
                });
            }

            if (methodsContainer) {
                methodsContainer.addEventListener('click', (e) => {
                    const target = e.target.closest('.payment-method-btn');
                    if (target) {
                        const method = target.dataset.method;
                        document.getElementById('payment-instruction-title').textContent = `Instructions for ${method}`;
                        document.getElementById('payment-instruction-steps').innerHTML = `
                            <p>1. Open your ${method} application.</p>
                            <p>2. Transfer to account number <strong>123-456-7890</strong> under the name <strong>CLEVR Edu</strong>.</p>
                            <p>3. Ensure the amount is exactly <strong>${currentCloverPackage.price}</strong>.</p>
                            <p>4. Click the button below once you have completed the transfer.</p>
                        `;
                        methodsContainer.classList.add('d-none');
                        instructionsContainer.classList.remove('d-none');
                    } else if (e.target.closest('.payment-back-btn')) {
                        paymentModalTitle.textContent = `Pay ${currentCloverPackage.price}`;
                        instructionsContainer.classList.add('d-none');
                        methodsContainer.classList.remove('d-none');
                    }
                });
            }

            if (instructionsContainer) {
                instructionsContainer.addEventListener('click', (e) => {
                    if (e.target.id === 'confirm-transfer-btn') {
                        hideCloverModal();
                        showNotification("Admin is checking your payment, Clovers will be added soon.", null, false);
                        
                        setTimeout(() => {
                            hideNotification();
                            setTimeout(() => {
                                user.clovers += currentCloverPackage.clovers;
                                // === PERBAIKAN 5: PANGGIL saveData() ===
                                // Simpan jumlah clover baru
                                saveData(); 
                                // === SELESAI PERBAIKAN 5 ===
                                updateCloverDisplay();
                                showNotification(`${currentCloverPackage.clovers} Clovers added successfully!`, true);
                            }, 400);
                        }, 2500);
                    } else if (e.target.closest('.payment-back-btn')) {
                        paymentModalTitle.textContent = `Pay ${currentCloverPackage.price}`;
                        instructionsContainer.classList.add('d-none');
                        methodsContainer.classList.remove('d-none');
                    }
                });
            }


            // Modal Close Buttons
            closeCloverModalBtn.addEventListener('click', () => {
                // Reset payment modal to initial state
                paymentModalTitle.textContent = 'Buy Clovers';
                instructionsContainer.classList.add('d-none');
                methodsContainer.classList.add('d-none');
                packagesContainer.classList.remove('d-none');
                hideCloverModal();
            });
            notificationCloseBtn.addEventListener('click', hideNotification);
            
            // Close Modal on Overlay Click
            buyCloverModal.addEventListener('click', (e) => { if(e.target === buyCloverModal) closeCloverModalBtn.click(); });
            notificationModal.addEventListener('click', (e) => { if(e.target === notificationModal) hideNotification(); });

            
             // Profile Page: Edit/Save logic
            document.getElementById('profilePage').addEventListener('click', (e) => {
                if (e.target.id === 'edit-profile-btn') {
                    renderProfilePage(true);
                } else if (e.target.id === 'save-profile-btn') {
                    // Get new values
                    const newName = document.getElementById('edit-profile-name').value;
                    const newDob = document.getElementById('edit-profile-dob').value;
                    const newEducation = document.getElementById('edit-profile-education').value;
                    const newAddress = document.getElementById('edit-profile-address').value;

                    // Update data object
                    if (currentLoggedInUser === 'student') {
                        studentProfile.name = newName;
                        studentProfile.dob = newDob;
                        studentProfile.education = newEducation;
                        studentProfile.address = newAddress;
                    } else if (tutors[currentLoggedInUser]) {
                        tutors[currentLoggedInUser].name = newName;
                        tutors[currentLoggedInUser].dob = newDob;
                        tutors[currentLoggedInUser].education = newEducation;
                        tutors[currentLoggedInUser].address = newAddress;
                    }

                    // === PERBAIKAN 6: PANGGIL saveData() ===
                    // Simpan perubahan profil ke localStorage
                    saveData();
                    // === SELESAI PERBAIKAN 6 ===

                    renderProfilePage(false); // Switch back to view mode
                    
                    // Tampilkan notifikasi setelah menyimpan
                    showNotification("Profile updated successfully!", true);
                }
                // === PERBAIKAN 7: TAMBAHKAN LOGIKA LOGOUT ===
                else if (e.target.id === 'logout-btn') {
                    // Hapus data login dari localStorage
                    localStorage.removeItem('clevrLoggedInUserId');
                    
                    // (Opsional) Hapus semua data untuk simulasi bersih
                    // localStorage.clear(); 
                    
                    // Kembali ke halaman login
                    window.location.href = 'index.html'; // Pastikan ini nama file login Anda
                }
                // === SELESAI PERBAIKAN 7 ===
            });
            
            // Semua listener lain (navigasi, chat, home, dll) telah dihapus.
        });
    </script>
</body>
</html>

